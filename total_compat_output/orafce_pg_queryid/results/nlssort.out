-- Tests for nlssort
-- Skip this test unless it's a Linux/glibc system with the "en_US.utf8" locale installed.
SELECT getdatabaseencoding() <> 'UTF8' OR
       NOT EXISTS (SELECT 1 FROM pg_collation WHERE collname = 'en_US' AND collencoding = pg_char_to_encoding('UTF8')) OR
       version() !~ 'linux-gnu'
       AS skip_test \gset
\if :skip_test
\quit
\endif
\set ECHO none
ERROR:  cache lookup failed for type 18
ERROR:  function nlssort(text, unknown) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name, 'en_US.utf8')...
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function nlssort(text, unknown) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name, '');
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function set_nls_sort(unknown) does not exist
LINE 1: SELECT set_nls_sort('invalid');
               ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function nlssort(text) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name);
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function set_nls_sort(unknown) does not exist
LINE 1: SELECT set_nls_sort('');
               ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function nlssort(text) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name);
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function set_nls_sort(unknown) does not exist
LINE 1: SELECT set_nls_sort('en_US.utf8');
               ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function nlssort(text) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name);
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
ERROR:  function nlssort(text) does not exist
LINE 1: SELECT * FROM test_sort ORDER BY NLSSORT(name);
                                         ^
HINT:  No function matches the given name and argument types. You might need to add explicit type casts.
